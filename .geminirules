# Regimen Pro Development Manifesto

You are an expert full-stack developer. You MUST adhere to the following Professional Workflow for every task.

## 0. Mandatory Session Startup
At the start of EVERY new session, you MUST read the following files to align with the current project state:
1. _project-system/knowledge-base/DEVELOPER_PROTOCOL.md (Follow the startup routine)
2. _project-system/knowledge-base/SYSTEM_CONTEXT.md
3. _project-system/knowledge-base/PROJECT_WISDOM.md

## 1. The Professional Workflow
Every request must follow these phases strictly:

### Phase 1: Initiation (The Anchor)
1. **Sync Workspace:** Run `npm run sync-tasks` to ensure local `_project-system/GH-Issues` match GitHub.
2. **Identify Task:** Use an existing GitHub Issue ID or create a new one.
3. **Move to In Progress:** Update the project item status to "In Progress".
4. **Branch Out:** Create a task-specific branch: `task-[ID]-short-description`.

### Phase 2: Implementation (The Build)
1. **Code:** Implement changes following project patterns (see Section 3).
2. **Update Docs:** Update technical implementation details in GHI files.
3. **Lint & Build:** Run `npm run build` to verify no syntax or import errors.

### Phase 3: UAT (User Acceptance Testing)
1. **Local Test:** Verify logic/UI changes locally.
2. **User Review:** Present changes to the user and wait for "Visual Sign-off".

### Phase 4: Delivery (The Pull Request)
1. **Commit:** Use Conventional Commits: `feat: ... (fixes #[ID])`.
2. **PR & Merge:** Create a PR, merge into `main`, and delete the task branch.

---

## 2. Core Architecture Mandates (V1.7.1+)

### A. State Management: The Slice Pattern
- **Modular Stores:** Never add logic to the root `useProgramStore.js`. Decompose logic into specialized slices in `stores/slices/`.
- **Schema Isolation:** Centralize all database queries in `services/database.service.js`. Never call `supabase` directly from components.
- **Dynamic Persistence:** Use dynamic keys for localStorage (`mp-v3-storage-${schema}`) to prevent data leakage between Production and Sandbox.

### B. UI Pattern: Decentralized Orchestrators
- **Feature Sovereignty:** Major views (Agenda, Library, Session, Builder) MUST act as their own orchestrators, managing internal UI state (tabs, local filters).
- **Direct Store Access:** Orchestrators should consume specific store slices directly to minimize prop-drilling from the root.

### C. Data Integrity: The Snapshot Rule
- **Immutable History:** Performance logs MUST store exercise names (`exercise_name_snapshot`) as plain text. History must NEVER depend solely on mutable template IDs.
- **Surgical Updates:** Program saves MUST use ID-based diffing. Never use "Delete-All" patterns for relational structures.

### D. Tactical Logic Standards
- **Timezone Safety:** Always use `.toLocaleDateString('en-CA')` (YYYY-MM-DD) for logic-level date comparisons to ensure reliability in Sofia (UTC+2).
- **PostgREST Clarity:** Use explicit relationship hints (e.g., `!fk_name`) in joins to prevent ambiguity errors (`PGRST201`).

---

## 3. GitHub & Project Standards
- **Branching:** `task-[ID]-description`.
- **Conventional Commits:** `type: description (fixes #[ID])`.
- **Changelog:** You MUST update `CHANGELOG.md` for every release or significant fix.