# Context Handoff: Session 2026-01-25T22-30

## Session Goal
Enable multi-program management, implement secure program editing and archiving, and establish a formal project changelog protocol.

## Key Actions & Changes
1.  **Database Hardening (V3)**:
    *   Identified and fixed a missing `user_id` column in `v3.programs` via a surgical Node.js/pg migration using the Session Pooler.
    *   Added `archived_at` column to support "Soft Deletes" (Safe Archiving).
    *   Corrected `cycle_length` calculation in the store to dynamically reflect the number of days in a program.
2.  **Program Management Suite**:
    *   **Context Switcher:** Replaced the static Library header with a dynamic dropdown to switch between multiple training programs.
    *   **Program Editor:** Implemented "Deep Hydration" to allow editing existing programs. Updated the store to use `upsert` for relational stability.
    *   **Safe Archiving:** Added ability to hide programs from the Library to reduce clutter while preserving 100% of historical performance data in the Master Agenda.
    *   **Graveyard (Restore):** Implemented a "Show Archived Programs" toggle in the Switcher to allow instant restoration of hidden plans.
3.  **Navigation Infrastructure**:
    *   Refactored `App.jsx` and `MasterPlanApp.jsx` to support `navState` (extra metadata).
    *   This ensures that deep-links (like a specific `programId` for editing) persist through refreshes and transitions.
4.  **Governance & Documentation**:
    *   Created `CHANGELOG.md` following the "Keep a Changelog" standard.
    *   Backfilled project history from version 1.0.0 to 1.3.0.
    *   Updated `.geminirules` with a mandatory **Changelog Management** protocol.

## Current State
*   The app is now a multi-program platform.
*   Users can create, edit, switch, and safely archive programs.
*   Training history is bulletproof and isolated from template deletions.
*   Changelog is initialized and part of the core developer workflow.

## Pending Items
*   **Dev Playground:** Implementation of the `v3_dev` schema and a "Schema Switcher" toggle for safe feature testing.
*   **Sync Logic:** Drafting the "Prod -> Dev" structural sync scripts.
