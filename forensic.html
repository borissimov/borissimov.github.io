<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INDEXED-DB FORENSICS</title>
    <style>
        body { background: #000; color: #0f0; font-family: sans-serif; padding: 15px; line-height: 1.6; }
        h1 { color: #fff; font-size: 22px; text-transform: uppercase; border-bottom: 2px solid #0f0; padding-bottom: 10px; }
        .db-card { border: 2px solid #0f0; padding: 15px; margin-bottom: 20px; background: #111; border-radius: 10px; }
        .status-msg { background: #333; color: #fff; padding: 10px; border-radius: 5px; font-weight: bold; margin-bottom: 20px; font-size: 16px; }
        .btn { background: #0f0; color: #000; border: none; padding: 15px; width: 100%; cursor: pointer; font-weight: 900; font-size: 16px; border-radius: 8px; text-transform: uppercase; margin-bottom: 10px; }
        pre { white-space: pre-wrap; word-break: break-all; background: #000; padding: 15px; border: 1px inset #0f0; font-family: monospace; font-size: 14px; color: #fff; overflow-x: auto; }
        h3 { margin-top: 0; color: #f29b11; font-size: 18px; }
    </style>
</head>
<body>
    <h1>Memory Scanner</h1>
    <div id="status" class="status-msg">Initializing Scan...</div>
    
    <button class="btn" onclick="copyEverything()">Copy Everything to Clipboard</button>
    
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');
        const status = document.getElementById('status');
        let fullDump = "";

        async function scanDBs() {
            status.innerText = "üîç Querying low-level databases...";
            const dbs = await window.indexedDB.databases();
            
            if (dbs.length === 0) {
                status.innerText = "‚ùå No hidden databases found.";
                return;
            }

            status.innerText = `üîç Found ${dbs.length} databases. Reading content...`;

            for (const dbInfo of dbs) {
                const card = document.createElement('div');
                card.className = 'db-card';
                card.innerHTML = `<h3>Database: ${dbInfo.name}</h3><div id="data-${dbInfo.name}">Opening storage...</div>`;
                results.appendChild(card);
                
                readDB(dbInfo.name);
            }
        }

        function readDB(name) {
            const request = indexedDB.open(name);
            request.onsuccess = (event) => {
                const db = event.target.result;
                const storeNames = Array.from(db.objectStoreNames);
                const display = document.getElementById(`data-${name}`);
                
                if (storeNames.length === 0) {
                    display.innerText = "No data stores in this database.";
                    return;
                }

                storeNames.forEach(storeName => {
                    try {
                        const transaction = db.transaction(storeName, "readonly");
                        const store = transaction.objectStore(storeName);
                        const getAll = store.getAll();
                        
                        getAll.onsuccess = () => {
                            const data = getAll.result;
                            const json = JSON.stringify(data, null, 2);
                            fullDump += `\n\n--- DB: ${name} | STORE: ${storeName} ---\n${json}`;
                            
                            const pre = document.createElement('pre');
                            pre.innerText = json;
                            display.innerHTML = `<strong>Store: ${storeName}</strong>`;
                            display.appendChild(pre);
                            
                            if (json.includes("weight") || json.includes("Jan 20")) {
                                status.innerText = "‚úÖ TARGET DATA DETECTED!";
                                status.style.background = "#c00";
                            }
                        };
                    } catch (e) {
                        display.innerText = "Could not read store: " + storeName;
                    }
                });
            };
        }

        function copyEverything() {
            const el = document.createElement('textarea');
            el.value = fullDump;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            alert("ALL DATA COPIED!\n\nPaste this into your notes or an email to save it.");
        }

        scanDBs();
    </script>
</body>
</html>