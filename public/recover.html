<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Plan - Forensic Data Recovery</title>
    <style>
        body { background: #0a0a0a; color: #ececec; font-family: monospace; padding: 20px; font-size: 13px; line-height: 1.4; }
        .card { background: #161616; border: 1px solid #333; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #f29b11; }
        .btn { background: #f29b11; color: #000; border: none; padding: 12px 20px; border-radius: 6px; font-weight: 900; cursor: pointer; width: 100%; text-transform: uppercase; margin-top: 10px; }
        .log-entry { color: #888; margin: 5px 0; }
        .highlight { color: #f29b11; font-weight: bold; }
        h1 { color: #f29b11; font-size: 18px; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .status { color: #2ecc71; font-weight: bold; }
        .error { color: #ef4444; }
    </style>
</head>
<body>
    <h1>Forensic Data Recovery v2.0</h1>
    <p>Searching for "Ghost Data" in all browser storage layers...</p>
    
    <div id="console"></div>
    <div id="results"></div>

    <script>
        const consoleDiv = document.getElementById('console');
        const resultsDiv = document.getElementById('results');

        function log(msg, type = '') {
            const p = document.createElement('div');
            p.className = 'log-entry ' + type;
            p.innerHTML = `> ${msg}`;
            consoleDiv.appendChild(p);
            console.log(msg);
        }

        async function runRecovery() {
            log("Initializing Deep Scan...");

            // 1. SCAN LOCALSTORAGE FOR GHOSTS
            log("Scanning LocalStorage for workout signatures...");
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const val = localStorage.getItem(key);
                
                // Search for workout signatures even if activeSession is null
                if (val.includes("Barbell Hip Thrusts") || val.includes("Leg Extensions")) {
                    log(`MATCH FOUND in key: <span class='highlight'>${key}</span>`, 'status');
                    displayFoundData(key, JSON.parse(val));
                }
            }

            // 2. SCAN INDEXED DB
            log("Scanning IndexedDB databases...");
            if (!window.indexedDB) {
                log("IndexedDB not supported", 'error');
            } else {
                const dbs = await window.indexedDB.databases();
                for (const dbInfo of dbs) {
                    log(`Checking database: ${dbInfo.name}`);
                    // Note: Deep scanning IDB requires complex cursor logic,
                    // starting with standard known app DBs
                }
            }

            log("Scan complete.");
        }

        function displayFoundData(key, data) {
            const card = document.createElement('div');
            card.className = 'card';
            
            // Try to find logs anywhere in the object
            const stringified = JSON.stringify(data);
            const hasLogs = stringified.includes('"weight"');

            card.innerHTML = `
                <h3>Storage Key: ${key}</h3>
                <p>Contains Workout Strings: <span class="status">YES</span></p>
                <p>Contains Logged Values: <span class="${hasLogs ? 'status' : 'error'}">${hasLogs ? 'YES' : 'NO'}</span></p>
                <pre style="font-size: 10px; background: #000; padding: 10px; max-height: 150px; overflow: auto;">${stringified.substring(0, 500)}...</pre>
                ${hasLogs ? `<button class="btn" onclick="rescue('${key}')">Rescue This Data</button>` : '<p><i>No loggable values found in this blob.</i></p>'}
            `;
            resultsDiv.appendChild(card);
        }

        async function rescue(key) {
            log(`Attempting rescue from ${key}...`);
            const raw = localStorage.getItem(key);
            const data = JSON.parse(raw);
            
            // This is a manual forensic rescue - we will dump the data to the screen 
            // so the user can copy it or we can try one last force-push
            alert("DATA LOCATED! Please take a screenshot of the next screen just in case.");
            document.body.innerHTML = `<h1>RESCUED DATA</h1><pre>${JSON.stringify(data, null, 2)}</pre><button class="btn" onclick="location.reload()">Back</button>`;
        }

        runRecovery();
    </script>
</body>
</html>